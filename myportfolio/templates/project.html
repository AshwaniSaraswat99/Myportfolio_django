{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projects</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

{% include 'components/navbar.html' %}

<div class="container mt-5">
  <h2 class="text-center mb-4">My Projects</h2>

  <!-- Project cards will appear here -->
  <div id="project-container" class="row g-4"></div>
</div>

<script>
  // Fetch projects from your Django API
  fetch('/api/projects/')
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById('project-container');
      container.innerHTML = ""; // clear previous content if any

      data.forEach(proj => {
        // handle image if available
        const imgTag = proj.image
          ? `<img src="${proj.image}" class="card-img-top" alt="${proj.title}">`
          : `<img src="{% static 'assets/default_project.png' %}" class="card-img-top" alt="default image">`;

        container.innerHTML += `
          <div class="col-md-6 col-lg-4">
            <div class="card h-100 shadow-sm">
              ${imgTag}
              <div class="card-body">
                <h5 class="card-title">${proj.title}</h5>
                <p class="card-text text-muted"><small>${new Date(proj.created_at).toLocaleDateString()}</small></p>
                <p class="card-text" style="max-height: 150px; overflow-y: auto;">
                  ${proj.description.slice(0, 200)}...
                </p>
                <a href="${proj.url}" target="_blank" class="btn btn-primary">View Project</a>
              </div>
            </div>
          </div>
        `;
      });
    })
    .catch(err => {
      console.error("Error fetching projects:", err);
      document.getElementById('project-container').innerHTML =
        `<p class="text-danger text-center">Unable to load projects right now. Please try again later.</p>`;
    });
</script>

</body>
</html>
